"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Non_Normalized_Path = void 0;
const _pt = __importStar(require("pareto-core-deserializer"));
const _pinternals = __importStar(require("pareto-core-internals"));
const temp_core_1 = require("../../temp/temp_core");
const Non_Normalized_Path = ($) => {
    const iterator = _pt.create_iterator(_pt.text_to_character_list($));
    return {
        'leading slash': iterator['get current']().transform(($) => {
            if ($ === 47) { // '/'
                iterator.consume();
                return true;
            }
            else {
                return false;
            }
        }, () => false),
        'segments': (0, temp_core_1.build_list_with_loop)(iterator, ($, $i) => {
            $i['add element'](_pinternals.cc((0, temp_core_1.build_text_with_loop)(iterator, ($, $i) => {
                if ($ !== 47) { // '/'
                    $i['add character']($);
                    iterator.consume();
                    return false;
                }
                else {
                    return true;
                }
            }), ($) => {
                switch ($) {
                    case "..": return ['parent', null];
                    case ".": return ['current', null];
                    case "": return ['nothing', null];
                    default: return ['child', $];
                }
            }));
            return iterator['get current']().transform(($) => {
                if ($ !== 47) { // '/'
                    _pinternals.panic(`Expected '/' but got character code ${$}`);
                }
                return iterator['look ahead'](1).transform(() => {
                    // There's more content after the slash, consume and continue
                    iterator.consume();
                    return false;
                }, () => {
                    // No more content, this is a trailing slash - don't consume, stop loop
                    return true;
                });
            }, () => true);
        }),
        'trailing slash': iterator['get current']().transform(($) => {
            if ($ === 47) { // '/'
                iterator.consume();
                return true;
            }
            else {
                return false;
            }
        }, () => false),
    };
};
exports.Non_Normalized_Path = Non_Normalized_Path;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9uX25vcm1hbGl6ZWRfcGF0aC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9pbXBsZW1lbnRhdGlvbi9kZXNlcmlhbGl6ZXJzL3NjaGVtYXMvbm9uX25vcm1hbGl6ZWRfcGF0aC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDhEQUErQztBQUUvQyxtRUFBb0Q7QUFFcEQsb0RBQWlGO0FBSTFFLE1BQU0sbUJBQW1CLEdBQUcsQ0FDL0IsQ0FBUyxFQUNnQixFQUFFO0lBQzNCLE1BQU0sUUFBUSxHQUFHLEdBQUcsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFFbkUsT0FBTztRQUNILGVBQWUsRUFBRSxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQ2hELENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDRixJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLE1BQU07Z0JBQ2xCLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtnQkFDbEIsT0FBTyxJQUFJLENBQUE7WUFDZixDQUFDO2lCQUFNLENBQUM7Z0JBQ0osT0FBTyxLQUFLLENBQUE7WUFDaEIsQ0FBQztRQUNMLENBQUMsRUFDRCxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQ2Q7UUFDRCxVQUFVLEVBQUUsSUFBQSxnQ0FBb0IsRUFBK0MsUUFBUSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFO1lBQy9GLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUM1QixJQUFBLGdDQUFvQixFQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRTtnQkFDckMsSUFBSSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxNQUFNO29CQUNsQixFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7b0JBQ3RCLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtvQkFDbEIsT0FBTyxLQUFLLENBQUE7Z0JBQ2hCLENBQUM7cUJBQU0sQ0FBQztvQkFDSixPQUFPLElBQUksQ0FBQTtnQkFDZixDQUFDO1lBQ0wsQ0FBQyxDQUFDLEVBQ0YsQ0FBQyxDQUFDLEVBQUUsRUFBRTtnQkFDRixRQUFRLENBQUMsRUFBRSxDQUFDO29CQUNSLEtBQUssSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQTtvQkFDbEMsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFBO29CQUNsQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUE7b0JBQ2pDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUE7Z0JBQ2hDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FDTCxDQUFBO1lBQ0QsT0FBTyxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQ3RDLENBQUMsQ0FBQyxFQUFFLEVBQUU7Z0JBQ0YsSUFBSSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxNQUFNO29CQUNsQixXQUFXLENBQUMsS0FBSyxDQUFDLHVDQUF1QyxDQUFDLEVBQUUsQ0FBQyxDQUFBO2dCQUNqRSxDQUFDO2dCQUNELE9BQU8sUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FDdEMsR0FBRyxFQUFFO29CQUNELDZEQUE2RDtvQkFDN0QsUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFBO29CQUNsQixPQUFPLEtBQUssQ0FBQTtnQkFDaEIsQ0FBQyxFQUNELEdBQUcsRUFBRTtvQkFDRCx1RUFBdUU7b0JBQ3ZFLE9BQU8sSUFBSSxDQUFBO2dCQUNmLENBQUMsQ0FDSixDQUFBO1lBQ0wsQ0FBQyxFQUNELEdBQUcsRUFBRSxDQUFDLElBQUksQ0FDYixDQUFBO1FBQ0wsQ0FBQyxDQUFDO1FBQ0YsZ0JBQWdCLEVBQUUsUUFBUSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUNqRCxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ0YsSUFBSSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxNQUFNO2dCQUNsQixRQUFRLENBQUMsT0FBTyxFQUFFLENBQUE7Z0JBQ2xCLE9BQU8sSUFBSSxDQUFBO1lBQ2YsQ0FBQztpQkFBTSxDQUFDO2dCQUNKLE9BQU8sS0FBSyxDQUFBO1lBQ2hCLENBQUM7UUFDTCxDQUFDLEVBQ0QsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUNkO0tBQ0osQ0FBQTtBQUNMLENBQUMsQ0FBQTtBQXJFWSxRQUFBLG1CQUFtQix1QkFxRS9CIn0=