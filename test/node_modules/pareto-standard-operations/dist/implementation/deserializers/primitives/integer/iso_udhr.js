"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.$$ = void 0;
const _pds = __importStar(require("pareto-core-deserializer"));
/**
 *
 * uhdr is a numerical representation of dates where day 0 is 1948-12-10 (the date of the adoption of the Universal Declaration of Human Rights)
 *
 * This function converts an ISO 8601 date string (YYYY-MM-DD) to a udhr day number
 */
const $$ = ($, abort) => {
    const iso_day_0_offset = -711471; // the number of days that iso day 1 (0001-01-01) is offset relative to udhr day 0 (1948-12-10)
    const month_day_table_normal = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
    const month_day_table_leap = [0, 31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335];
    const is_leap_year = (year) => (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
    const characters = _pds.text_to_character_list($);
    const parse_iso_date = (characters) => {
        const get_certain_character_at = (characters, index) => {
            return characters.__get_element_at(index).transform(($) => $, () => abort(`index out of bounds`));
        };
        const string_to_number = (characters, start, end) => {
            let result = 0;
            for (let i = start; i < end; i++) {
                const digit = get_certain_character_at(characters, i) - 48;
                if (digit < 0 || digit > 9)
                    return abort(`invalid date format`);
                result = result * 10 + digit;
            }
            return result;
        };
        const dash = 45;
        //validate format
        if (characters.get_number_of_elements() !== 10) { // YYYY-MM-DD
            return abort(`invalid date format`);
        }
        if (get_certain_character_at(characters, 4) !== dash) { // -
            return abort(`invalid date format`);
        }
        if (get_certain_character_at(characters, 7) !== dash) { // -
            return abort(`invalid date format`);
        }
        return {
            year: string_to_number(characters, 0, 4),
            month: string_to_number(characters, 5, 7),
            day: string_to_number(characters, 8, 10)
        };
    };
    const iso_date = parse_iso_date(characters);
    // Validate month (1-12)
    if (iso_date.month < 1 || iso_date.month > 12) {
        abort(`Invalid month: ${iso_date.month}. Month must be between 1 and 12`);
    }
    // Validate day (1-31, depending on month)
    if (iso_date.day < 1) {
        abort(`Invalid day: ${iso_date.day}. Day must be at least 1`);
    }
    // Check days per month
    const days_in_month = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
    let max_day = days_in_month[iso_date.month - 1];
    // Adjust for leap year in February
    if (iso_date.month === 2 && is_leap_year(iso_date.year)) {
        max_day = 29;
    }
    if (iso_date.day > max_day) {
        abort(`Invalid day: ${iso_date.day}. Month ${iso_date.month} has at most ${max_day} days`);
    }
    const full_years = iso_date.year - 1;
    const leap_days_before_current_year = +_pds.integer_division(full_years, 4, _pds.unreachable_code_path())
        - _pds.integer_division(full_years, 100, _pds.unreachable_code_path())
        + _pds.integer_division(full_years, 400, _pds.unreachable_code_path());
    const total_days_before_current_year = full_years * 365 + leap_days_before_current_year;
    const month_days = is_leap_year(iso_date.year) ? month_day_table_leap : month_day_table_normal;
    const days_in_current_year = month_days[iso_date.month - 1] + iso_date.day;
    // Calculate total days since January 1, year 1 CE
    const total_days_since_iso_year_1 = total_days_before_current_year + days_in_current_year;
    // Convert to UDHR day number (add days from  1948-12-10)
    const udhr_day = total_days_since_iso_year_1 + iso_day_0_offset;
    return udhr_day;
};
exports.$$ = $$;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXNvX3VkaHIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvaW1wbGVtZW50YXRpb24vZGVzZXJpYWxpemVycy9wcmltaXRpdmVzL2ludGVnZXIvaXNvX3VkaHIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQSwrREFBZ0Q7QUFJaEQ7Ozs7O0dBS0c7QUFDSSxNQUFNLEVBQUUsR0FBeUQsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUU7SUFFakYsTUFBTSxnQkFBZ0IsR0FBRyxDQUFFLE1BQU0sQ0FBQSxDQUFDLCtGQUErRjtJQUVqSSxNQUFNLHNCQUFzQixHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUN0RixNQUFNLG9CQUFvQixHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtJQVFwRixNQUFNLFlBQVksR0FBRyxDQUFDLElBQVksRUFBVyxFQUFFLENBQzNDLENBQUMsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUE7SUFHOUQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFBO0lBRWpELE1BQU0sY0FBYyxHQUFHLENBQ25CLFVBQTRCLEVBQ3BCLEVBQUU7UUFHVixNQUFNLHdCQUF3QixHQUFHLENBQUMsVUFBNEIsRUFBRSxLQUFhLEVBQVUsRUFBRTtZQUNyRixPQUFPLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxTQUFTLENBQy9DLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQ1IsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQ3JDLENBQUE7UUFDTCxDQUFDLENBQUE7UUFFRCxNQUFNLGdCQUFnQixHQUFHLENBQUMsVUFBNEIsRUFBRSxLQUFhLEVBQUUsR0FBVyxFQUFVLEVBQUU7WUFDMUYsSUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFBO1lBQ2QsS0FBSyxJQUFJLENBQUMsR0FBRyxLQUFLLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUMvQixNQUFNLEtBQUssR0FBRyx3QkFBd0IsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFBO2dCQUMxRCxJQUFJLEtBQUssR0FBRyxDQUFDLElBQUksS0FBSyxHQUFHLENBQUM7b0JBQUUsT0FBTyxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQTtnQkFDL0QsTUFBTSxHQUFHLE1BQU0sR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFBO1lBQ2hDLENBQUM7WUFDRCxPQUFPLE1BQU0sQ0FBQTtRQUNqQixDQUFDLENBQUE7UUFDRCxNQUFNLElBQUksR0FBRyxFQUFFLENBQUE7UUFFZixpQkFBaUI7UUFDakIsSUFBSSxVQUFVLENBQUMsc0JBQXNCLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLGFBQWE7WUFDM0QsT0FBTyxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQTtRQUN2QyxDQUFDO1FBQ0QsSUFBSSx3QkFBd0IsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJO1lBQ3hELE9BQU8sS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUE7UUFDdkMsQ0FBQztRQUNELElBQUksd0JBQXdCLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSTtZQUN4RCxPQUFPLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBO1FBQ3ZDLENBQUM7UUFDRCxPQUFPO1lBQ0gsSUFBSSxFQUFFLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3hDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN6QyxHQUFHLEVBQUUsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7U0FDM0MsQ0FBQTtJQUVMLENBQUMsQ0FBQTtJQUVELE1BQU0sUUFBUSxHQUFHLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQTtJQUUzQyx3QkFBd0I7SUFDeEIsSUFBSSxRQUFRLENBQUMsS0FBSyxHQUFHLENBQUMsSUFBSSxRQUFRLENBQUMsS0FBSyxHQUFHLEVBQUUsRUFBRSxDQUFDO1FBQzVDLEtBQUssQ0FBQyxrQkFBa0IsUUFBUSxDQUFDLEtBQUssa0NBQWtDLENBQUMsQ0FBQTtJQUM3RSxDQUFDO0lBRUQsMENBQTBDO0lBQzFDLElBQUksUUFBUSxDQUFDLEdBQUcsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUNuQixLQUFLLENBQUMsZ0JBQWdCLFFBQVEsQ0FBQyxHQUFHLDBCQUEwQixDQUFDLENBQUE7SUFDakUsQ0FBQztJQUVELHVCQUF1QjtJQUN2QixNQUFNLGFBQWEsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUE7SUFDdEUsSUFBSSxPQUFPLEdBQUcsYUFBYSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFFL0MsbUNBQW1DO0lBQ25DLElBQUksUUFBUSxDQUFDLEtBQUssS0FBSyxDQUFDLElBQUksWUFBWSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ3RELE9BQU8sR0FBRyxFQUFFLENBQUE7SUFDaEIsQ0FBQztJQUVELElBQUksUUFBUSxDQUFDLEdBQUcsR0FBRyxPQUFPLEVBQUUsQ0FBQztRQUN6QixLQUFLLENBQUMsZ0JBQWdCLFFBQVEsQ0FBQyxHQUFHLFdBQVcsUUFBUSxDQUFDLEtBQUssZ0JBQWdCLE9BQU8sT0FBTyxDQUFDLENBQUE7SUFDOUYsQ0FBQztJQUVELE1BQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFBO0lBQ3BDLE1BQU0sNkJBQTZCLEdBQy9CLENBQUUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7VUFDbEUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7VUFDcEUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUMsQ0FBQTtJQUUxRSxNQUFNLDhCQUE4QixHQUFHLFVBQVUsR0FBRyxHQUFHLEdBQUcsNkJBQTZCLENBQUE7SUFFdkYsTUFBTSxVQUFVLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLHNCQUFzQixDQUFBO0lBQzlGLE1BQU0sb0JBQW9CLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQTtJQUUxRSxrREFBa0Q7SUFDbEQsTUFBTSwyQkFBMkIsR0FBRyw4QkFBOEIsR0FBRyxvQkFBb0IsQ0FBQTtJQUV6Rix5REFBeUQ7SUFDekQsTUFBTSxRQUFRLEdBQUcsMkJBQTJCLEdBQUcsZ0JBQWdCLENBQUE7SUFFL0QsT0FBTyxRQUFRLENBQUE7QUFDbkIsQ0FBQyxDQUFBO0FBdkdZLFFBQUEsRUFBRSxNQXVHZCJ9